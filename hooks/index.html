<html lang=en>
 <head>
  <meta charset=UTF-8><meta name=viewport
      content="width=device-width, initial-scale=1">
  <title>Hooks</title>
  <link rel=alternate
        href=https://40ants.com/reblocks/changelog.xml
        type=application/rss+xml>
  <link rel=stylesheet type=text/css
        href=../theme.css>
  <script type=text/javascript src=../jquery.js></script>
  <script type=text/javascript src=../toc.js></script>
  <link rel=stylesheet type=text/css
        href=../highlight.min.css>
  <script type=text/javascript
          src=../highlight.min.js></script>
  <script type=text/javascript>hljs.highlightAll();</script>
  <script type=text/javascript>
             MathJax = {
               tex: {
                 inlineMath: [[&#39;$&#39;,&#39;$&#39;]],
                 processEscapes: true
               }
             };
        </script>
  <script type=text/javascript
          src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js></script>
  <script type=text/javascript>$(document).ready(function() {$(&#39;a:has(img)&#39;).css(&#39;border-bottom&#39;, &#39;none&#39;)})</script>
 </head>
 <body>
  <div class=page><a id=fork-me href=https://github.com/40ants/reblocks>Fork me on GitHub</a>
   <div class=navbar>
    <div class=navbar-inner>
     <a class=brand href="/">
      <img class=logo
           src=https://40ants.com/img/logo.svg></a>
     <ul class=nav>
      <li><a href=/about.html>Who We Are</a>
      <li><a href=https://gitter.im/40ants/team>Chat With Us</a>
      <li><a href=/tips.html>Lisp Tips</a>
      <li><a href=/projects.html>Our Projects</a>
     </ul>
    </div>
   </div>
   <input type=checkbox id=sidebar-check>
   <label for=sidebar-check>
    <div id=sidebar-trigger>
     <span></span><span></span><span></span>
    </div></label><div class=sidebar><div class=header><form class=search method=GET
      action="../search/">
      <input type=text name=q>
      <input type=submit value=Search><span id=search-progress></span>
     </form>
    </div><div class=content><div class=page-toc><ul><li><p><a href="../#x-28REBLOCKS-2FDOC-2FINDEX-3A-40INDEX-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../" data-node="x-28REBLOCKS-2FDOC-2FINDEX-3A-40INDEX-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Introduction</a></p><ul><li><p><a href="../#core-features-of-reblocks" data-document="../" data-node="core-features-of-reblocks">Core Features of Reblocks</a></p></li><li><p><a href="../#removed-features" data-document="../" data-node="removed-features">Removed Features</a></p></li><li><p><a href="../#learning-reblocks" data-document="../" data-node="learning-reblocks">Learning Reblocks</a></p></li><li><p><a href="../#getting-support" data-document="../" data-node="getting-support">Getting Support</a></p></li></ul></li><li><p><a href="../installation/#x-28REBLOCKS-2FDOC-2FINSTALLATION-3A-40INSTALLATION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../installation/" data-node="x-28REBLOCKS-2FDOC-2FINSTALLATION-3A-40INSTALLATION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Installation</a></p><ul><li><p><a href="../installation/#setup-your-common-lisp-environment" data-document="../installation/" data-node="setup-your-common-lisp-environment">Setup your Common Lisp environment</a></p><ul><li><p><a href="../installation/#common-lisp-implementation" data-document="../installation/" data-node="common-lisp-implementation">Common Lisp implementation</a></p></li><li><p><a href="../installation/#development-environment-setup" data-document="../installation/" data-node="development-environment-setup">Development environment setup</a></p></li></ul></li><li><p><a href="../installation/#installation" data-document="../installation/" data-node="installation">Installation</a></p></li></ul></li><li><p><a href="../quickstart/#x-28REBLOCKS-2FDOC-2FQUICKSTART-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../quickstart/" data-node="x-28REBLOCKS-2FDOC-2FQUICKSTART-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Quickstart</a></p><ul><li><p><a href="../quickstart/#the-task-widget" data-document="../quickstart/" data-node="the-task-widget">The Task widget</a></p></li><li><p><a href="../quickstart/#the-tasks-list-widget" data-document="../quickstart/" data-node="the-tasks-list-widget">The Tasks-list widget</a></p></li><li><p><a href="../quickstart/#adding-tasks" data-document="../quickstart/" data-node="adding-tasks">Adding tasks</a></p></li><li><p><a href="../quickstart/#toggle-tasks" data-document="../quickstart/" data-node="toggle-tasks">Toggle tasks</a></p></li><li><p><a href="../quickstart/#what-is-next" data-document="../quickstart/" data-node="what-is-next">What is next?</a></p></li></ul></li><li><p><a href="../components/#x-28REBLOCKS-2FDOC-2FCOMPONENTS-3A-40COMPONENTS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../components/" data-node="x-28REBLOCKS-2FDOC-2FCOMPONENTS-3A-40COMPONENTS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Components</a></p><ul><li><p><a href="../components/#widgets" data-document="../components/" data-node="widgets">Widgets</a></p></li><li><p><a href="../components/#actions" data-document="../components/" data-node="actions">Actions</a></p></li><li><p><a href="../components/#navigations-and-dispatchers" data-document="../components/" data-node="navigations-and-dispatchers">Navigations and dispatchers</a></p></li><li><p><a href="../components/#servers" data-document="../components/" data-node="servers">Servers</a></p></li></ul></li><li><p><a href="../apps/#x-28REBLOCKS-2FDOC-2FAPP-3A-3A-40APPS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../apps/" data-node="x-28REBLOCKS-2FDOC-2FAPP-3A-3A-40APPS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Apps</a></p><ul><li><p><a href="../apps/#api" data-document="../apps/" data-node="api">API</a></p></li></ul></li><li><p><a href="../widgets/#x-28REBLOCKS-2FDOC-2FWIDGETS-3A-3A-40WIDGETS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../widgets/" data-node="x-28REBLOCKS-2FDOC-2FWIDGETS-3A-3A-40WIDGETS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Widgets</a></p><ul><li><p><a href="../widgets/#example" data-document="../widgets/" data-node="example">Example</a></p></li><li><p><a href="../widgets/#api" data-document="../widgets/" data-node="api">API</a></p></li></ul></li><li><p><a href="../rendering/#x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40RENDERING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../rendering/" data-node="x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40RENDERING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Content Rendering</a></p><ul><li><p><a href="../rendering/#x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40PAGE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../rendering/" data-node="x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40PAGE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Page Rendering</a></p></li><li><p><a href="../rendering/#x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40HTML-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../rendering/" data-node="x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40HTML-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">HTML Rendering</a></p><ul><li><p><a href="../rendering/#api" data-document="../rendering/" data-node="api">API</a></p></li></ul></li></ul></li><li><p><a href="../actions/#x-28REBLOCKS-2FDOC-2FACTIONS-3A-3A-40ACTIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../actions/" data-node="x-28REBLOCKS-2FDOC-2FACTIONS-3A-3A-40ACTIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Actions</a></p><ul><li><p><a href="../actions/#application-actions" data-document="../actions/" data-node="application-actions">Application actions</a></p></li><li><p><a href="../actions/#session-actions" data-document="../actions/" data-node="session-actions">Session actions</a></p></li><li><p><a href="../actions/#using-at-the-frontend" data-document="../actions/" data-node="using-at-the-frontend">Using at the Frontend</a></p></li><li><p><a href="../actions/#api" data-document="../actions/" data-node="api">API</a></p></li></ul></li><li><p><a href="../routing/#x-28REBLOCKS-2FDOC-2FROUTING-3A-40ROUTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../routing/" data-node="x-28REBLOCKS-2FDOC-2FROUTING-3A-40ROUTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Routing</a></p><ul><li><p><a href="../routing/#x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../routing/" data-node="x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Quickstart</a></p><ul><li><p><a href="../routing/#getting-started" data-document="../routing/" data-node="getting-started">Getting started</a></p></li><li><p><a href="../routing/#extending-the-example-to-each-task-an-id" data-document="../routing/" data-node="extending-the-example-to-each-task-an-id">Extending the example: to each task an id</a></p></li><li><p><a href="../routing/#the-task-page-widget" data-document="../routing/" data-node="the-task-page-widget">The task-page widget</a></p></li><li><p><a href="../routing/#defining-routes" data-document="../routing/" data-node="defining-routes">Defining routes</a></p></li><li><p><a href="../routing/#path-and-url-parameters" data-document="../routing/" data-node="path-and-url-parameters">Path and URL parameters</a></p></li><li><p><a href="../routing/#redirections" data-document="../routing/" data-node="redirections">Redirections</a></p></li><li><p><a href="../routing/#final-steps" data-document="../routing/" data-node="final-steps">Final steps</a></p></li></ul></li><li><p><a href="../routing/#x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40LOWLEVEL-API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../routing/" data-node="x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40LOWLEVEL-API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Lowlevel API</a></p></li></ul></li><li><p><a href="../dependencies/#x-28REBLOCKS-2FDOC-2FDEPENDENCIES-3A-3A-40DEPENDENCIES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../dependencies/" data-node="x-28REBLOCKS-2FDOC-2FDEPENDENCIES-3A-3A-40DEPENDENCIES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Dependencies</a></p><ul><li><p><a href="../dependencies/#api" data-document="../dependencies/" data-node="api">API</a></p></li></ul></li><li><p><a href="../request/#x-28REBLOCKS-2FDOC-2FREQUEST-3A-3A-40REQUEST-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../request/" data-node="x-28REBLOCKS-2FDOC-2FREQUEST-3A-3A-40REQUEST-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Request</a></p><ul><li><p><a href="../request/#api" data-document="../request/" data-node="api">API</a></p></li></ul></li><li><p><a href="../response/#x-28REBLOCKS-2FDOC-2FRESPONSE-3A-3A-40RESPONSE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../response/" data-node="x-28REBLOCKS-2FDOC-2FRESPONSE-3A-3A-40RESPONSE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Response</a></p><ul><li><p><a href="../response/#api" data-document="../response/" data-node="api">API</a></p></li></ul></li><li><p><a href="#x-28REBLOCKS-2FDOC-2FHOOKS-3A-3A-40HOOKS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="" data-node="x-28REBLOCKS-2FDOC-2FHOOKS-3A-3A-40HOOKS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Hooks</a></p><ul><li><p><a href="#how-to-use-these-hooks" data-document="" data-node="how-to-use-these-hooks">How to use these hooks?</a></p></li><li><p><a href="#defining-your-own-hooks" data-document="" data-node="defining-your-own-hooks">Defining your own hooks</a></p></li><li><p><a href="#hooks-api" data-document="" data-node="hooks-api">Hooks API</a></p></li></ul></li><li><p><a href="../session/#x-28REBLOCKS-2FDOC-2FSESSION-3A-3A-40SESSION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../session/" data-node="x-28REBLOCKS-2FDOC-2FSESSION-3A-3A-40SESSION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Using the Session</a></p><ul><li><p><a href="../session/#session-initialization" data-document="../session/" data-node="session-initialization">Session initialization</a></p></li><li><p><a href="../session/#storing-data" data-document="../session/" data-node="storing-data">Storing data</a></p></li><li><p><a href="../session/#api" data-document="../session/" data-node="api">API</a></p></li></ul></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FINDEX-3A-3A-40REMOVED-FEATURES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FINDEX-3A-3A-40REMOVED-FEATURES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Removed Features</a></p><ul><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FVIEWS-3A-3A-40VIEWS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FVIEWS-3A-3A-40VIEWS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Views</a></p></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FTEMPLATES-3A-3A-40TEMPLATES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FTEMPLATES-3A-3A-40TEMPLATES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Templates</a></p><ul><li><p><a href="../removed-features/#template-function" data-document="../removed-features/" data-node="template-function">Template function</a></p></li><li><p><a href="../removed-features/#template-definition" data-document="../removed-features/" data-node="template-definition">Template definition</a></p></li></ul></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FFORMS-3A-3A-40FORMS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FFORMS-3A-3A-40FORMS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Forms</a></p><ul><li><p><a href="../removed-features/#introduction" data-document="../removed-features/" data-node="introduction">Introduction</a></p></li><li><p><a href="../removed-features/#simple-example" data-document="../removed-features/" data-node="simple-example">Simple example</a></p></li><li><p><a href="../removed-features/#quickforms" data-document="../removed-features/" data-node="quickforms">Quickforms</a></p></li></ul></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FCONTINUATIONS-3A-3A-40CONTINUATIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FCONTINUATIONS-3A-3A-40CONTINUATIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Continuations-based tools</a></p></li></ul></li><li><p><a href="../api/#x-28REBLOCKS-2FDOC-2FAPI-3A-40API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../api/" data-node="x-28REBLOCKS-2FDOC-2FAPI-3A-40API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Unsorted API</a></p><ul><li><p><a href="../api/#variables" data-document="../api/" data-node="variables">Variables</a></p></li></ul></li><li><p><a href="../contribute/#x-28REBLOCKS-2FDOC-2FCONTRIBUTE-3A-3A-40CONTRIBUTE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../contribute/" data-node="x-28REBLOCKS-2FDOC-2FCONTRIBUTE-3A-3A-40CONTRIBUTE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Contributing to Reblocks</a></p></li><li><p><a href="../changelog/#x-28REBLOCKS-2FDOC-2FCHANGELOG-3A-40CHANGELOG-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../changelog/" data-node="x-28REBLOCKS-2FDOC-2FCHANGELOG-3A-40CHANGELOG-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">ChangeLog</a></p></li></ul>
     </div>
    </div><div class=footer>
     <a href=https://40ants.com/doc>[generated by 40ANTS-DOC]</a>
    </div>
   </div><div class=content role=main><h1>Hooks<a class=header-link
     href=#x-28REBLOCKS-2FDOC-2FHOOKS-3A-3A-40HOOKS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29
     title="Permalink to this headline"
     id=x-28REBLOCKS-2FDOC-2FHOOKS-3A-3A-40HOOKS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29>
      ¶</a></h1><p>Reblocks provides a hooks mechanism to allow to set callbacks on different events.
These callbacks are cooled &quot;hooks&quot;. Each hook can be added on one of three levels:</p><ul><li><p>application;</p></li><li><p>session;</p></li><li><p>request.</p></li></ul><p>Hooks added on request level expire after the request was processed. This could be useful
for commiting changes to the database.</p><p>Session level hooks are called have a longer life time and work while user session is active.
They are bound to a session. Some user might have a hook installed in his session and other user don't.
This way you might implement such things like turning on debug information, etc.</p><p>Application level hooks are stored permanently and work for every user. Despite the name, they aren't
bound to an application. These hooks are global and work for any application and any reblocks server.</p><p>Hooks are defined to be called on some event happened in the reblocks application.
Here is a list of hooks, predefined in the Reblocks:</p><ul>
     <li><a
      href=#x-28REBLOCKS-2FHOOKS-3A-3AHANDLE-HTTP-REQUEST-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/hooks.lisp#L347>
         [hook]</a>
        <div class=reference-object
             style="display: inline-block">
         <a
         href=#x-28REBLOCKS-2FHOOKS-3A-3AHANDLE-HTTP-REQUEST-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29
         id=x-28REBLOCKS-2FHOOKS-3A-3AHANDLE-HTTP-REQUEST-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29>
          reblocks/hooks::handle-http-request</a>
        </div></span><span class=locative-args>env</span><p>Called around code reponsible for an <code>HTTP</code> request processing,
   before any application was choosen.</p><p>Accepts Lack's <code>HTTP</code> request environment.</p><p>Should return a list of three items:</p><ul><li><p><code>HTTP</code> status code;</p></li><li><p>a plist of <code>HTTP</code> headers;</p></li><li><p>a list of strings corresponding to the page's content.</p></li></ul> </span>
    </ul><ul>
     <li><a
      href=#x-28REBLOCKS-2FHOOKS-3A-3ASTART-REBLOCKS-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/hooks.lisp#L359>
         [hook]</a>
        <div class=reference-object
             style="display: inline-block">
         <a
         href=#x-28REBLOCKS-2FHOOKS-3A-3ASTART-REBLOCKS-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29
         id=x-28REBLOCKS-2FHOOKS-3A-3ASTART-REBLOCKS-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29>
          reblocks/hooks::start-reblocks</a>
        </div></span><p>Called around code which starts all applications and a webserver.</p><p>   Returns a reblocks server object.</p></span>
    </ul><ul>
     <li><a
      href=#x-28REBLOCKS-2FHOOKS-3A-3ASTOP-REBLOCKS-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/hooks.lisp#L364>
         [hook]</a>
        <div class=reference-object
             style="display: inline-block">
         <a
         href=#x-28REBLOCKS-2FHOOKS-3A-3ASTOP-REBLOCKS-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29
         id=x-28REBLOCKS-2FHOOKS-3A-3ASTOP-REBLOCKS-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29>
          reblocks/hooks::stop-reblocks</a>
        </div></span><p>Called around code which stops all applications and a webserver.</p><p>   Returns a reblocks server object.</p></span>
    </ul><ul>
     <li><a
      href=#x-28REBLOCKS-2FHOOKS-3A-3AACTION-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/hooks.lisp#L369>
         [hook]</a>
        <div class=reference-object
             style="display: inline-block">
         <a
         href=#x-28REBLOCKS-2FHOOKS-3A-3AACTION-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29
         id=x-28REBLOCKS-2FHOOKS-3A-3AACTION-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29>
          reblocks/hooks::action</a>
        </div></span><span class=locative-args>app action-name action-arguments</span><p>Called when action is processed.</p><p>   Returns a result of <a href="https://40ants.com/reblocks/actions/#x-28REBLOCKS-2FACTIONS-3AEVAL-ACTION-20GENERIC-FUNCTION-29" data-document="https://40ants.com/reblocks/actions/" data-node="x-28REBLOCKS-2FACTIONS-3AEVAL-ACTION-20GENERIC-FUNCTION-29"><code>reblocks/actions:eval-action</code></a> generic-function application
   to the arguments.</p> </span>
    </ul><ul>
     <li><a
      href=#x-28REBLOCKS-2FHOOKS-3A-3ARENDER-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/hooks.lisp#L375>
         [hook]</a>
        <div class=reference-object
             style="display: inline-block">
         <a
         href=#x-28REBLOCKS-2FHOOKS-3A-3ARENDER-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29
         id=x-28REBLOCKS-2FHOOKS-3A-3ARENDER-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29>
          reblocks/hooks::render</a>
        </div></span><span class=locative-args>app</span><p>Called when around whole page or ajax request processing.
   Should return <code>HTML</code> string.</p> </span>
    </ul><ul>
     <li><a
      href=#x-28REBLOCKS-2FHOOKS-3A-3ARESET-SESSION-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/hooks.lisp#L379>
         [hook]</a>
        <div class=reference-object
             style="display: inline-block">
         <a
         href=#x-28REBLOCKS-2FHOOKS-3A-3ARESET-SESSION-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29
         id=x-28REBLOCKS-2FHOOKS-3A-3ARESET-SESSION-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29>
          reblocks/hooks::reset-session</a>
        </div></span><span class=locative-args>session</span><p>Called when session is resetted for some reason.</p> </span>
    </ul><h2 id="how-to-use-these-hooks">How to use these hooks?</h2><p>Lets pretend we want to create an extension which will collect all <code>SQL</code> queries
and render them in hidden panel like Django Debug Toolbar does? To accomplish
this task, we need to add an application-wide <a href="https://40ants.com/reblocks/hooks/#x-28REBLOCKS-2FHOOKS-3A-3ARENDER-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29" data-document="https://40ants.com/reblocks/hooks/" data-node="x-28REBLOCKS-2FHOOKS-3A-3ARENDER-20-2840ANTS-DOC-2FLOCATIVES-3A-3AHOOK-29-29"><code>render</code></a> hook:</p><pre><code class="">(defun inject-debug-panel (html)
  (str:replace-first &quot;&lt;/html&gt;&quot;
                     &quot;&lt;div id=\&quot;debug-panel\&quot;&gt;
                         DEBUG PANEL EXAMPLE
                      &lt;/div&gt;
                   &lt;/html&gt;&quot;
                     html))

(reblocks/hooks:on-application-hook-render
  collect-sql-queries-on-render (app)
  
  (let* ((*collect-sql* t)
         (resulting-html (reblocks/hooks:call-next-hook)))
    (inject-debug-panel resulting-html)))</code></pre><p>As you can see, we've added a hook using <code>ON-APPLICATION-HOOK-RENDER</code> macro
and used <a href="https://40ants.com/reblocks/hooks/#x-28REBLOCKS-2FHOOKS-3ACALL-NEXT-HOOK-20FUNCTION-29" data-document="https://40ants.com/reblocks/hooks/" data-node="x-28REBLOCKS-2FHOOKS-3ACALL-NEXT-HOOK-20FUNCTION-29"><code>call-next-hook</code></a> function inside it's body. This is very similar
to generic functions, but instead of methods, we are calling nested hooks. Hooks added
later wraps hooks added earlier.</p><p>If you don't call <a href="https://40ants.com/reblocks/hooks/#x-28REBLOCKS-2FHOOKS-3ACALL-NEXT-HOOK-20FUNCTION-29" data-document="https://40ants.com/reblocks/hooks/" data-node="x-28REBLOCKS-2FHOOKS-3ACALL-NEXT-HOOK-20FUNCTION-29"><code>call-next-hook</code></a> function explicitly, it will be called implicitly
after your hook's body. This makes your code called before hook's event.</p><h2 id="defining-your-own-hooks">Defining your own hooks</h2><p>You can use hooks mechanics in your own code by defining and calling hooks.</p><p>First, you need to define a hook using <a href="https://40ants.com/reblocks/hooks/#x-28REBLOCKS-2FHOOKS-3ADEFHOOK-20-2840ANTS-DOC-2FLOCATIVES-3AMACRO-29-29" data-document="https://40ants.com/reblocks/hooks/" data-node="x-28REBLOCKS-2FHOOKS-3ADEFHOOK-20-2840ANTS-DOC-2FLOCATIVES-3AMACRO-29-29"><code>defhook</code></a> macro. Then choose piece of code
you want to make hookable and wrap it with another macro, defined by <a href="https://40ants.com/reblocks/hooks/#x-28REBLOCKS-2FHOOKS-3ADEFHOOK-20-2840ANTS-DOC-2FLOCATIVES-3AMACRO-29-29" data-document="https://40ants.com/reblocks/hooks/" data-node="x-28REBLOCKS-2FHOOKS-3ADEFHOOK-20-2840ANTS-DOC-2FLOCATIVES-3AMACRO-29-29"><code>defhook</code></a>.</p><p>For example, you creating a Reblocks extension which allows users to register
on a website. You also want to allow develope who will use your extension
to define additional actions when a new user get registered on site. For example,
admin might want to validate age and also to send user a greeting email after registration.</p><p>To accomplish this task, we need to define a hook:</p><pre><code class="">(reblocks/hooks:defhook create-user (age name email)
    &quot;Called around the code which creates a new user. Returns a user object.&quot;)</code></pre><p>This macro will define more macros inside <code>REBLOCKS</code>/<code>HOOKS</code> package:</p><ul><li><p><code>ON-SESSION-HOOK-CREATE-USER</code></p></li><li><p><code>ON-REQUEST-HOOK-CREATE-USER</code></p></li><li><p><code>ON-APPLICATION-HOOK-CREATE-USER</code></p></li><li><p><code>WITH-CREATE-USER-HOOK</code></p></li><li><p><code>CALL-CREATE-USER-HOOK</code></p></li></ul><p>Now, you need to use <code>WITH-CREATE-USER-HOOK</code> macro to wrap around
code creating the user. In some cases, when you just want to call hooks
you can use <code>CALL-…-HOOK</code> version which is equal to calling <code>WITH-…-HOOK</code>
without any body.</p><p>Here is how you can use it now:</p><pre><code class="">(defun process-new-user-form (age name email)
  (reblocks/hooks:with-create-user-hook (age name email)
    ;; For simplicity, we using a plist here.
    ;; A real application should store the record
    ;; in a database and return class instance.
    (list :age age
          :name name
          :email email)))</code></pre><p>When we call this function, it will return our plist:</p><pre><code class="">REBLOCKS/DOC/HOOKS&gt; (process-new-user-form 42 &quot;Sasha&quot; &quot;sasha@40ants.com&quot;)
(:AGE 42 :NAME &quot;Sasha&quot; :EMAIL &quot;sasha@40ants.com&quot;)</code></pre><p>Now let's add a hook:</p><pre><code class="">(reblocks/hooks:on-application-hook-create-user
    check-age (age name email)
 (format t &quot;Checking age of a new user&quot;))</code></pre><p>and create a new user</p><pre><code class="">REBLOCKS/DOC/HOOKS&gt; (process-new-user-form 9 &quot;Ilia&quot; &quot;ilia@40ants.com&quot;)
Checking age of a new user
(:AGE 9 :NAME &quot;Ilia&quot; :EMAIL &quot;ilia@40ants.com&quot;)</code></pre><h2 id="hooks-api">Hooks API</h2><ul>
     <li><a
      href=#x-28REBLOCKS-2FHOOKS-3ADEFHOOK-20-2840ANTS-DOC-2FLOCATIVES-3AMACRO-29-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/hooks.lisp#L270>
         [macro]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FHOOKS-3ADEFHOOK-20-2840ANTS-DOC-2FLOCATIVES-3AMACRO-29-29
         id=x-28REBLOCKS-2FHOOKS-3ADEFHOOK-20-2840ANTS-DOC-2FLOCATIVES-3AMACRO-29-29>
          reblocks/hooks:defhook</a>
        </div></span><span class=locative-args>name (&amp;rest args) &amp;optional docstring</span><p>Registers a hook</p> </span>
    </ul><ul>
     <li><a href=#x-28REBLOCKS-2FHOOKS-3ACALL-NEXT-HOOK-20FUNCTION-29></a><span
      class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/hooks.lisp#L78>
         [function]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FHOOKS-3ACALL-NEXT-HOOK-20FUNCTION-29
         id=x-28REBLOCKS-2FHOOKS-3ACALL-NEXT-HOOK-20FUNCTION-29>
          reblocks/hooks:call-next-hook</a>
        </div></span><p>This function should be called inside a body, surrounded by <code>ON-APPLICATION-HOOK-…</code>, <code>ON-SESSION-HOOK-…</code> or a <code>ON-REQUEST-HOOK-…</code> type of macro.</p></span>
    </ul>
   </div><div class=footer>
    <hr class=separator>
    <p class=fineprint>Created with passion by <em>40Ants</em><a class=lisp-logo
     href="http://lisp-lang.org/">
      <img
           src=https://40ants.com/img/made-with-lisp.svg></a>
   </div>
  </div>
 </body>
</html>