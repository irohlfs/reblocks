<html lang=en>
 <head>
  <meta charset=UTF-8><meta name=viewport
      content="width=device-width, initial-scale=1">
  <title>Actions</title>
  <link rel=alternate
        href=https://40ants.com/reblocks/changelog.xml
        type=application/rss+xml>
  <link rel=stylesheet type=text/css
        href=../theme.css>
  <script type=text/javascript src=../jquery.js></script>
  <script type=text/javascript src=../toc.js></script>
  <link rel=stylesheet type=text/css
        href=../highlight.min.css>
  <script type=text/javascript
          src=../highlight.min.js></script>
  <script type=text/javascript>hljs.highlightAll();</script>
  <script type=text/javascript>
             MathJax = {
               tex: {
                 inlineMath: [[&#39;$&#39;,&#39;$&#39;]],
                 processEscapes: true
               }
             };
        </script>
  <script type=text/javascript
          src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js></script>
  <script type=text/javascript>$(document).ready(function() {$(&#39;a:has(img)&#39;).css(&#39;border-bottom&#39;, &#39;none&#39;)})</script>
 </head>
 <body>
  <div class=page><a id=fork-me href=https://github.com/40ants/reblocks>Fork me on GitHub</a>
   <div class=navbar>
    <div class=navbar-inner>
     <a class=brand href="/">
      <img class=logo
           src=https://40ants.com/img/logo.svg></a>
     <ul class=nav>
      <li><a href=/about.html>Who We Are</a>
      <li><a href=https://gitter.im/40ants/team>Chat With Us</a>
      <li><a href=/tips.html>Lisp Tips</a>
      <li><a href=/projects.html>Our Projects</a>
     </ul>
    </div>
   </div>
   <input type=checkbox id=sidebar-check>
   <label for=sidebar-check>
    <div id=sidebar-trigger>
     <span></span><span></span><span></span>
    </div></label><div class=sidebar><div class=header><form class=search method=GET
      action="../search/">
      <input type=text name=q>
      <input type=submit value=Search><span id=search-progress></span>
     </form>
    </div><div class=content><div class=page-toc><ul><li><p><a href="../#x-28REBLOCKS-2FDOC-2FINDEX-3A-40INDEX-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../" data-node="x-28REBLOCKS-2FDOC-2FINDEX-3A-40INDEX-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Introduction</a></p><ul><li><p><a href="../#core-features-of-reblocks" data-document="../" data-node="core-features-of-reblocks">Core Features of Reblocks</a></p></li><li><p><a href="../#removed-features" data-document="../" data-node="removed-features">Removed Features</a></p></li><li><p><a href="../#learning-reblocks" data-document="../" data-node="learning-reblocks">Learning Reblocks</a></p></li><li><p><a href="../#getting-support" data-document="../" data-node="getting-support">Getting Support</a></p></li></ul></li><li><p><a href="../installation/#x-28REBLOCKS-2FDOC-2FINSTALLATION-3A-40INSTALLATION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../installation/" data-node="x-28REBLOCKS-2FDOC-2FINSTALLATION-3A-40INSTALLATION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Installation</a></p><ul><li><p><a href="../installation/#setup-your-common-lisp-environment" data-document="../installation/" data-node="setup-your-common-lisp-environment">Setup your Common Lisp environment</a></p><ul><li><p><a href="../installation/#common-lisp-implementation" data-document="../installation/" data-node="common-lisp-implementation">Common Lisp implementation</a></p></li><li><p><a href="../installation/#development-environment-setup" data-document="../installation/" data-node="development-environment-setup">Development environment setup</a></p></li></ul></li><li><p><a href="../installation/#installation" data-document="../installation/" data-node="installation">Installation</a></p></li></ul></li><li><p><a href="../quickstart/#x-28REBLOCKS-2FDOC-2FQUICKSTART-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../quickstart/" data-node="x-28REBLOCKS-2FDOC-2FQUICKSTART-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Quickstart</a></p><ul><li><p><a href="../quickstart/#the-task-widget" data-document="../quickstart/" data-node="the-task-widget">The Task widget</a></p></li><li><p><a href="../quickstart/#the-tasks-list-widget" data-document="../quickstart/" data-node="the-tasks-list-widget">The Tasks-list widget</a></p></li><li><p><a href="../quickstart/#adding-tasks" data-document="../quickstart/" data-node="adding-tasks">Adding tasks</a></p></li><li><p><a href="../quickstart/#toggle-tasks" data-document="../quickstart/" data-node="toggle-tasks">Toggle tasks</a></p></li><li><p><a href="../quickstart/#what-is-next" data-document="../quickstart/" data-node="what-is-next">What is next?</a></p></li></ul></li><li><p><a href="../components/#x-28REBLOCKS-2FDOC-2FCOMPONENTS-3A-40COMPONENTS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../components/" data-node="x-28REBLOCKS-2FDOC-2FCOMPONENTS-3A-40COMPONENTS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Components</a></p><ul><li><p><a href="../components/#widgets" data-document="../components/" data-node="widgets">Widgets</a></p></li><li><p><a href="../components/#actions" data-document="../components/" data-node="actions">Actions</a></p></li><li><p><a href="../components/#navigations-and-dispatchers" data-document="../components/" data-node="navigations-and-dispatchers">Navigations and dispatchers</a></p></li><li><p><a href="../components/#servers" data-document="../components/" data-node="servers">Servers</a></p></li></ul></li><li><p><a href="../apps/#x-28REBLOCKS-2FDOC-2FAPP-3A-3A-40APPS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../apps/" data-node="x-28REBLOCKS-2FDOC-2FAPP-3A-3A-40APPS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Apps</a></p><ul><li><p><a href="../apps/#api" data-document="../apps/" data-node="api">API</a></p></li></ul></li><li><p><a href="../widgets/#x-28REBLOCKS-2FDOC-2FWIDGETS-3A-3A-40WIDGETS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../widgets/" data-node="x-28REBLOCKS-2FDOC-2FWIDGETS-3A-3A-40WIDGETS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Widgets</a></p><ul><li><p><a href="../widgets/#example" data-document="../widgets/" data-node="example">Example</a></p></li><li><p><a href="../widgets/#api" data-document="../widgets/" data-node="api">API</a></p></li></ul></li><li><p><a href="../rendering/#x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40RENDERING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../rendering/" data-node="x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40RENDERING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Content Rendering</a></p><ul><li><p><a href="../rendering/#x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40PAGE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../rendering/" data-node="x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40PAGE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Page Rendering</a></p></li><li><p><a href="../rendering/#x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40HTML-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../rendering/" data-node="x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40HTML-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">HTML Rendering</a></p><ul><li><p><a href="../rendering/#api" data-document="../rendering/" data-node="api">API</a></p></li></ul></li></ul></li><li><p><a href="#x-28REBLOCKS-2FDOC-2FACTIONS-3A-3A-40ACTIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="" data-node="x-28REBLOCKS-2FDOC-2FACTIONS-3A-3A-40ACTIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Actions</a></p><ul><li><p><a href="#application-actions" data-document="" data-node="application-actions">Application actions</a></p></li><li><p><a href="#session-actions" data-document="" data-node="session-actions">Session actions</a></p></li><li><p><a href="#using-at-the-frontend" data-document="" data-node="using-at-the-frontend">Using at the Frontend</a></p></li><li><p><a href="#api" data-document="" data-node="api">API</a></p></li></ul></li><li><p><a href="../routing/#x-28REBLOCKS-2FDOC-2FROUTING-3A-40ROUTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../routing/" data-node="x-28REBLOCKS-2FDOC-2FROUTING-3A-40ROUTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Routing</a></p><ul><li><p><a href="../routing/#x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../routing/" data-node="x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Quickstart</a></p><ul><li><p><a href="../routing/#getting-started" data-document="../routing/" data-node="getting-started">Getting started</a></p></li><li><p><a href="../routing/#extending-the-example-to-each-task-an-id" data-document="../routing/" data-node="extending-the-example-to-each-task-an-id">Extending the example: to each task an id</a></p></li><li><p><a href="../routing/#the-task-page-widget" data-document="../routing/" data-node="the-task-page-widget">The task-page widget</a></p></li><li><p><a href="../routing/#defining-routes" data-document="../routing/" data-node="defining-routes">Defining routes</a></p></li><li><p><a href="../routing/#path-and-url-parameters" data-document="../routing/" data-node="path-and-url-parameters">Path and URL parameters</a></p></li><li><p><a href="../routing/#redirections" data-document="../routing/" data-node="redirections">Redirections</a></p></li><li><p><a href="../routing/#final-steps" data-document="../routing/" data-node="final-steps">Final steps</a></p></li></ul></li><li><p><a href="../routing/#x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40LOWLEVEL-API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../routing/" data-node="x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40LOWLEVEL-API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Lowlevel API</a></p></li></ul></li><li><p><a href="../dependencies/#x-28REBLOCKS-2FDOC-2FDEPENDENCIES-3A-3A-40DEPENDENCIES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../dependencies/" data-node="x-28REBLOCKS-2FDOC-2FDEPENDENCIES-3A-3A-40DEPENDENCIES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Dependencies</a></p><ul><li><p><a href="../dependencies/#api" data-document="../dependencies/" data-node="api">API</a></p></li></ul></li><li><p><a href="../request/#x-28REBLOCKS-2FDOC-2FREQUEST-3A-3A-40REQUEST-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../request/" data-node="x-28REBLOCKS-2FDOC-2FREQUEST-3A-3A-40REQUEST-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Request</a></p><ul><li><p><a href="../request/#api" data-document="../request/" data-node="api">API</a></p></li></ul></li><li><p><a href="../response/#x-28REBLOCKS-2FDOC-2FRESPONSE-3A-3A-40RESPONSE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../response/" data-node="x-28REBLOCKS-2FDOC-2FRESPONSE-3A-3A-40RESPONSE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Response</a></p><ul><li><p><a href="../response/#api" data-document="../response/" data-node="api">API</a></p></li></ul></li><li><p><a href="../hooks/#x-28REBLOCKS-2FDOC-2FHOOKS-3A-3A-40HOOKS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../hooks/" data-node="x-28REBLOCKS-2FDOC-2FHOOKS-3A-3A-40HOOKS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Hooks</a></p><ul><li><p><a href="../hooks/#how-to-use-these-hooks" data-document="../hooks/" data-node="how-to-use-these-hooks">How to use these hooks?</a></p></li><li><p><a href="../hooks/#defining-your-own-hooks" data-document="../hooks/" data-node="defining-your-own-hooks">Defining your own hooks</a></p></li><li><p><a href="../hooks/#hooks-api" data-document="../hooks/" data-node="hooks-api">Hooks API</a></p></li></ul></li><li><p><a href="../session/#x-28REBLOCKS-2FDOC-2FSESSION-3A-3A-40SESSION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../session/" data-node="x-28REBLOCKS-2FDOC-2FSESSION-3A-3A-40SESSION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Using the Session</a></p><ul><li><p><a href="../session/#session-initialization" data-document="../session/" data-node="session-initialization">Session initialization</a></p></li><li><p><a href="../session/#storing-data" data-document="../session/" data-node="storing-data">Storing data</a></p></li><li><p><a href="../session/#api" data-document="../session/" data-node="api">API</a></p></li></ul></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FINDEX-3A-3A-40REMOVED-FEATURES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FINDEX-3A-3A-40REMOVED-FEATURES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Removed Features</a></p><ul><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FVIEWS-3A-3A-40VIEWS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FVIEWS-3A-3A-40VIEWS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Views</a></p></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FTEMPLATES-3A-3A-40TEMPLATES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FTEMPLATES-3A-3A-40TEMPLATES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Templates</a></p><ul><li><p><a href="../removed-features/#template-function" data-document="../removed-features/" data-node="template-function">Template function</a></p></li><li><p><a href="../removed-features/#template-definition" data-document="../removed-features/" data-node="template-definition">Template definition</a></p></li></ul></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FFORMS-3A-3A-40FORMS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FFORMS-3A-3A-40FORMS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Forms</a></p><ul><li><p><a href="../removed-features/#introduction" data-document="../removed-features/" data-node="introduction">Introduction</a></p></li><li><p><a href="../removed-features/#simple-example" data-document="../removed-features/" data-node="simple-example">Simple example</a></p></li><li><p><a href="../removed-features/#quickforms" data-document="../removed-features/" data-node="quickforms">Quickforms</a></p></li></ul></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FCONTINUATIONS-3A-3A-40CONTINUATIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FCONTINUATIONS-3A-3A-40CONTINUATIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Continuations-based tools</a></p></li></ul></li><li><p><a href="../api/#x-28REBLOCKS-2FDOC-2FAPI-3A-40API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../api/" data-node="x-28REBLOCKS-2FDOC-2FAPI-3A-40API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Unsorted API</a></p><ul><li><p><a href="../api/#variables" data-document="../api/" data-node="variables">Variables</a></p></li></ul></li><li><p><a href="../contribute/#x-28REBLOCKS-2FDOC-2FCONTRIBUTE-3A-3A-40CONTRIBUTE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../contribute/" data-node="x-28REBLOCKS-2FDOC-2FCONTRIBUTE-3A-3A-40CONTRIBUTE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Contributing to Reblocks</a></p></li><li><p><a href="../changelog/#x-28REBLOCKS-2FDOC-2FCHANGELOG-3A-40CHANGELOG-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../changelog/" data-node="x-28REBLOCKS-2FDOC-2FCHANGELOG-3A-40CHANGELOG-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">ChangeLog</a></p></li></ul>
     </div>
    </div><div class=footer>
     <a href=https://40ants.com/doc>[generated by 40ANTS-DOC]</a>
    </div>
   </div><div class=content role=main><h1>Actions<a class=header-link
     href=#x-28REBLOCKS-2FDOC-2FACTIONS-3A-3A-40ACTIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29
     title="Permalink to this headline"
     id=x-28REBLOCKS-2FDOC-2FACTIONS-3A-3A-40ACTIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29>
      ¶</a></h1><p>Actions is the core component allowing interactivity in Reblocks applications.</p><p>Actions are callbacks that are stored in a session and can be called from the browser
using <code>AJAX</code>, <code>POST</code> or <code>GET</code> requests.</p><p>There are two types of actions:</p><ul><li><p>Application-wide.</p></li><li><p>Session-bound.</p></li></ul><h2 id="application-actions">Application actions</h2><p>This kind of actions is good when you want to build a scalable application,
because amount of memory they are taking does not grow with number of user
sessions.</p><p>Application action should be a function which only depends on it's argument.
They should not closeup any variables because the same function will be called
for every application's user.</p><p>Here is an example, how to define such action which will create a new user:</p><pre><code class="lisp">(reblocks/app:defapp demo-actions
  :autostart nil)

(reblocks/app-actions:define-action create-user demo-actions (name email)
  (format t &quot;User ~A with email ~A was created.~%&quot;
          name email))</code></pre><p>After that, this function can be called by name</p><pre><code class="lisp">(let ((app (make-instance 'demo-actions)))
  (reblocks/actions:eval-action app
                                &quot;create-user&quot;
                                (list &quot;Bob&quot;
                                      &quot;bob@40ants.com&quot;))))
=&gt; &quot;User Bob with email bob@40ants.com was created.&quot;</code></pre><h2 id="session-actions">Session actions</h2><p>Session actions can be a stand-alone functions or closures. This makes
it easier to catch some variables and to use them when user interacts
with application.</p><p>However, such closures are stored in a hash table bound to the each session.
This makes a few consequences:</p><ul><li><p>it impossible to use database as a session storage and after application
  restart all session actions are expire.</p></li><li><p>it makes harder to scale application, because now you need to
  redirect each user to a single backend, using <a href="https://www.haproxy.com/blog/client-ip-persistence-or-source-ip-hash-load-balancing/">sticky sessions</a> on the
  balancer.</p></li><li><p>session actions tend to accumulate over time and eat more memory.</p></li></ul><p>In the next example, we can see how it is easy to catch <code>USER</code> variable
into the action's closure and then use it when email will be provided:</p><pre><code class="lisp">(let ((user &quot;Bob&quot;))
  (reblocks-test/utils:with-session
    (let ((action-id
            (reblocks/actions:make-action
             (lambda (email)
               (format t &quot;Changing email for user ~A to ~A&quot;
                       user email)))))
      (reblocks/actions:eval-action nil
                                    action-id
                                    (list &quot;bob@40ants.com&quot;)))))
.. &lt;DEBUG&gt; [12:11:44] reblocks/actions actions.lisp (eval-action) -
..   Calling REBLOCKS/ACTIONS::ACTION: #&lt;FUNCTION (LAMBDA
..                                                    (
..                                                     EMAIL)) {7009B6328B}&gt;
..   with REBLOCKS/ACTIONS::ARGUMENTS: (&quot;bob@40ants.com&quot;)
..   and REBLOCKS/ACTIONS::ACTION-NAME: &quot;11626:ca7db51f4b0ffb082dcc560eed1b6121707d9677&quot;
..   
.. Changing email for user Bob to bob@40ants.com
=&gt; NIL</code></pre><p>With application-wide action you'll have to render user's id in the hidden
field of <code>HTML</code> form and then to retrieve the user object from the database
when action get called.</p><p>Now lets see how to use actions from the frontend!</p><h2 id="using-at-the-frontend">Using at the Frontend</h2><p>At the fronted you might want to call actions as the result of user's click,
form submit or some other act, for example, by timer.</p><p>Reblocks provides a thin <code>JS</code> layer which includes following functions:</p><ul><li><p><code>initiateAction(actionCode, options)</code></p></li><li><p><code>initiateFormAction(actionCode, form, options)</code></p></li></ul><p><b><code>initiateAction(actionCode, options)</code></b></p><p>This function calls given action using <code>AJAX</code>. You have to pass optional
arguments as <code>JS</code> object <code>options</code>:</p><pre><code class="json">{
    &quot;method&quot;: &quot;POST&quot;,
    &quot;args&quot;: {},
    &quot;url&quot;: undefined,
    &quot;on_success&quot;: undefined,
    &quot;on_failure&quot;: undefined,
}</code></pre><p>Here is an example which uses <a href="https://40ants.com/reblocks/actions/#x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-20FUNCTION-29" data-document="https://40ants.com/reblocks/actions/" data-node="x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-20FUNCTION-29"><code>make-action</code></a> and renders usual <code>HTML</code> link as a button
bound to an anonymous lisp function:</p><div class=demo>
 <iframe
         sandbox="allow-forms allow-same-origin allow-scripts"
         id=example-5
         src="https://com-40ants-reblocks-examples.herokuapp.com/examples/reblocks/doc/actions/button-click?iframe-id=example-5"
         style="width: 100%; height: 10em; border: 0"></iframe>
</div>
<script>
window.addEventListener('message', function(e) {
  let message = e.data;
  let iframe_id = message.iframe_id;
  let iframe = document.querySelector('#' + iframe_id);
  iframe.style.height = message.height + 'px';
  iframe.style.width = message.width + 'px';
} , false);
</script><p>Also, you might generate a link using <a href="https://40ants.com/reblocks/actions/#x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-URL-20FUNCTION-29" data-document="https://40ants.com/reblocks/actions/" data-node="x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-URL-20FUNCTION-29"><code>make-action-url</code></a> function and use it as <code>HREF</code>
argument of any link on a page. Click on such link will trigger the action.</p><p>Here I intentionally didn't add a &quot;button&quot; class to show that this is just a link.</p><p>Pay attention how this example flickers when you click the link. This is because
the whole iframe's content is reloaded when you click the link. In the previous
example this is not happening because click leads to an <code>AJAX</code> requst and only a
piece of page get updated.</p><div class=demo>
 <iframe
         sandbox="allow-forms allow-same-origin allow-scripts"
         id=example-6
         src="https://com-40ants-reblocks-examples.herokuapp.com/examples/reblocks/doc/actions/just-href?iframe-id=example-6"
         style="width: 100%; height: 10em; border: 0"></iframe>
</div>
<script>
window.addEventListener('message', function(e) {
  let message = e.data;
  let iframe_id = message.iframe_id;
  let iframe = document.querySelector('#' + iframe_id);
  iframe.style.height = message.height + 'px';
  iframe.style.width = message.width + 'px';
} , false);
</script><p>In the next example, we'll pass arguments to our action. To do this, we have
to call <a href="https://40ants.com/reblocks/actions/#x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-20FUNCTION-29" data-document="https://40ants.com/reblocks/actions/" data-node="x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-20FUNCTION-29"><code>make-action</code></a> and render <code>JS</code> code manually:</p><div class=demo>
 <iframe
         sandbox="allow-forms allow-same-origin allow-scripts"
         id=example-7
         src="https://com-40ants-reblocks-examples.herokuapp.com/examples/reblocks/doc/actions/many-buttons-click?iframe-id=example-7"
         style="width: 100%; height: 10em; border: 0"></iframe>
</div>
<script>
window.addEventListener('message', function(e) {
  let message = e.data;
  let iframe_id = message.iframe_id;
  let iframe = document.querySelector('#' + iframe_id);
  iframe.style.height = message.height + 'px';
  iframe.style.width = message.width + 'px';
} , false);
</script><p><b><code>initiateFormAction(actionCode, form, options)</code></b></p><p>This version of function accepts a form jquery object as the second argument.
Options argument has the same meaning as for <code>initiateAction</code> function,
but <code>args</code> attrbute is formed from the serialized form fields and default
<code>method</code> is taken from the form's <code>method</code> attribute.</p><p>Next example shows how to process a form submit, using a callback,
registered with <a href="https://40ants.com/reblocks/actions/#x-28REBLOCKS-2FACTIONS-3AMAKE-JS-FORM-ACTION-20FUNCTION-29" data-document="https://40ants.com/reblocks/actions/" data-node="x-28REBLOCKS-2FACTIONS-3AMAKE-JS-FORM-ACTION-20FUNCTION-29"><code>make-js-form-action</code></a>:</p><div class=demo>
 <iframe
         sandbox="allow-forms allow-same-origin allow-scripts"
         id=example-8
         src="https://com-40ants-reblocks-examples.herokuapp.com/examples/reblocks/doc/actions/form-example?iframe-id=example-8"
         style="width: 100%; height: 10em; border: 0"></iframe>
</div>
<script>
window.addEventListener('message', function(e) {
  let message = e.data;
  let iframe_id = message.iframe_id;
  let iframe = document.querySelector('#' + iframe_id);
  iframe.style.height = message.height + 'px';
  iframe.style.width = message.width + 'px';
} , false);
</script><h2 id="api">API</h2><ul>
     <li><a href=#x-28REBLOCKS-2FACTIONS-3AEVAL-ACTION-20GENERIC-FUNCTION-29></a><span
      class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/actions.lisp#L41>
         [generic-function]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FACTIONS-3AEVAL-ACTION-20GENERIC-FUNCTION-29
         id=x-28REBLOCKS-2FACTIONS-3AEVAL-ACTION-20GENERIC-FUNCTION-29>
          reblocks/actions:eval-action</a>
        </div></span><span class=locative-args>app action-name arguments</span><p>Evaluates the action that came with the request.</p><p>First it resolves action by trying to find <code>ACTION-NAME</code> inside session
or current app's actions.
If actions wasn't found, then <a href="https://40ants.com/reblocks/actions/#x-28REBLOCKS-2FACTIONS-3AEVAL-ACTION-20GENERIC-FUNCTION-29" data-document="https://40ants.com/reblocks/actions/" data-node="x-28REBLOCKS-2FACTIONS-3AEVAL-ACTION-20GENERIC-FUNCTION-29"><code>eval-action</code></a> calls <a href="https://40ants.com/reblocks/actions/#x-28REBLOCKS-2FACTIONS-3AON-MISSING-ACTION-20GENERIC-FUNCTION-29" data-document="https://40ants.com/reblocks/actions/" data-node="x-28REBLOCKS-2FACTIONS-3AON-MISSING-ACTION-20GENERIC-FUNCTION-29"><code>on-missing-action</code></a> generic-function.
Otherwise it applies arguments to the action callback.</p> </span>
    </ul><ul>
     <li><a href=#x-28REBLOCKS-2FACTIONS-3AON-MISSING-ACTION-20GENERIC-FUNCTION-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/actions.lisp#L34>
         [generic-function]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FACTIONS-3AON-MISSING-ACTION-20GENERIC-FUNCTION-29
         id=x-28REBLOCKS-2FACTIONS-3AON-MISSING-ACTION-20GENERIC-FUNCTION-29>
          reblocks/actions:on-missing-action</a>
        </div></span><span class=locative-args>app action-name</span><p>Must be overridden by application to prevent default
behaviour - redirect to a root of the application.
The new method should determine the behavior in this
situation (e.g. redirect, signal an error, etc.).</p> </span>
    </ul><ul>
     <li><a href=#x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-20FUNCTION-29></a><span
      class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/actions.lisp#L109>
         [function]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-20FUNCTION-29
         id=x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-20FUNCTION-29>
          reblocks/actions:make-action</a>
        </div></span><span class=locative-args>function-or-action</span><p>Accepts a function or an existing action. If the value is a
function, adds it to the session actions and returns its unique code as a string.
Otherwise, checks if the action already exists. If it does, returns the argument as is.
If it does not, signals an error.</p> </span>
    </ul><ul>
     <li><a href=#x-28REBLOCKS-2FACTIONS-3AMAKE-JS-ACTION-20FUNCTION-29></a><span
      class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/actions.lisp#L175>
         [function]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FACTIONS-3AMAKE-JS-ACTION-20FUNCTION-29
         id=x-28REBLOCKS-2FACTIONS-3AMAKE-JS-ACTION-20FUNCTION-29>
          reblocks/actions:make-js-action</a>
        </div></span><span class=locative-args>action</span><p>Returns <code>JS</code> code which can be inserted into <code>onclick</code> attribute and will
execute given Lisp function on click.</p><p>It accepts any function as input and produces a string with JavaScript code.</p> </span>
    </ul><ul>
     <li><a href=#x-28REBLOCKS-2FACTIONS-3AMAKE-JS-FORM-ACTION-20FUNCTION-29></a><span
      class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/actions.lisp#L185>
         [function]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FACTIONS-3AMAKE-JS-FORM-ACTION-20FUNCTION-29
         id=x-28REBLOCKS-2FACTIONS-3AMAKE-JS-FORM-ACTION-20FUNCTION-29>
          reblocks/actions:make-js-form-action</a>
        </div></span><span class=locative-args>action</span><p>Returns <code>JS</code> code which can be inserted into <code>onsubmit</code> form's attribute.</p><p>It accepts any function as input and produces a string with JavaScript code.</p><p>On form submit given action will be executed and all input values
will be passed as arguments.</p> </span>
    </ul><ul>
     <li><a href=#x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-URL-20FUNCTION-29></a><span
      class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/actions.lisp#L142>
         [function]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-URL-20FUNCTION-29
         id=x-28REBLOCKS-2FACTIONS-3AMAKE-ACTION-URL-20FUNCTION-29>
          reblocks/actions:make-action-url</a>
        </div></span><span class=locative-args>function-or-action-code &amp;key (keep-query-params t)</span><p>Accepts action code and returns a <code>URL</code> that can be used as <code>href</code> attribute of <code>HTML</code> link.</p><p>For example:</p><pre><code class="cl-transcript">(reblocks/app:defapp test-app :autostart nil)

(let ((reblocks/request::*request*
        (lack.request:make-request
         (list :path-info &quot;/blah/minor&quot;
               :headers (make-hash-table)))))
  (reblocks/app:with-app (make-instance 'test-app)
    (reblocks/app-actions:define-action test-action test-app ())
    (reblocks/actions:make-action-url &quot;test-action&quot;)))
=&gt; &quot;/blah/minor?action=test-action&quot;</code></pre><p>If <code>KEEP-QUERY-PARAMS</code> is true (default), then all query arguments are preserved
and will be passed as arguments to the action.</p> </span>
    </ul><ul>
     <li><a href=#x-28REBLOCKS-2FVARIABLES-3A-2AACTION-STRING-2A-20-28VARIABLE-29-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/variables.lisp#L26>
         [variable]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FVARIABLES-3A-2AACTION-STRING-2A-20-28VARIABLE-29-29
         id=x-28REBLOCKS-2FVARIABLES-3A-2AACTION-STRING-2A-20-28VARIABLE-29-29>
          reblocks/variables:*action-string*</a>
        </div></span><span class=locative-args>&quot;action&quot;</span><p>A string used to pass actions from a client to the server. See
'reblocks/request:get-request-action'.</p> </span>
    </ul><ul>
     <li><a
      href=#x-28REBLOCKS-2FVARIABLES-3A-2AIGNORE-MISSING-ACTIONS-2A-20-28VARIABLE-29-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/variables.lisp#L19>
         [variable]</a>
        <div class=reference-object
             style="display: inline-block">
         <a
         href=#x-28REBLOCKS-2FVARIABLES-3A-2AIGNORE-MISSING-ACTIONS-2A-20-28VARIABLE-29-29
         id=x-28REBLOCKS-2FVARIABLES-3A-2AIGNORE-MISSING-ACTIONS-2A-20-28VARIABLE-29-29>
          reblocks/variables:*ignore-missing-actions*</a>
        </div></span><span class=locative-args>t</span></span>
    </ul>
   </div><div class=footer>
    <hr class=separator>
    <p class=fineprint>Created with passion by <em>40Ants</em><a class=lisp-logo
     href="http://lisp-lang.org/">
      <img
           src=https://40ants.com/img/made-with-lisp.svg></a>
   </div>
  </div>
 </body>
</html>