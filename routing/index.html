<html lang=en>
 <head>
  <meta charset=UTF-8><meta name=viewport
      content="width=device-width, initial-scale=1">
  <title>Routing</title>
  <link rel=alternate
        href=https://40ants.com/reblocks/changelog.xml
        type=application/rss+xml>
  <link rel=stylesheet type=text/css
        href=../theme.css>
  <script type=text/javascript src=../jquery.js></script>
  <script type=text/javascript src=../toc.js></script>
  <link rel=stylesheet type=text/css
        href=../highlight.min.css>
  <script type=text/javascript
          src=../highlight.min.js></script>
  <script type=text/javascript>hljs.highlightAll();</script>
  <script type=text/javascript>
             MathJax = {
               tex: {
                 inlineMath: [[&#39;$&#39;,&#39;$&#39;]],
                 processEscapes: true
               }
             };
        </script>
  <script type=text/javascript
          src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js></script>
  <script type=text/javascript>$(document).ready(function() {$(&#39;a:has(img)&#39;).css(&#39;border-bottom&#39;, &#39;none&#39;)})</script>
 </head>
 <body>
  <div class=page><a id=fork-me href=https://github.com/40ants/reblocks>Fork me on GitHub</a>
   <div class=navbar>
    <div class=navbar-inner>
     <a class=brand href="/">
      <img class=logo
           src=https://40ants.com/img/logo.svg></a>
     <ul class=nav>
      <li><a href=/about.html>Who We Are</a>
      <li><a href=https://gitter.im/40ants/team>Chat With Us</a>
      <li><a href=/tips.html>Lisp Tips</a>
      <li><a href=/projects.html>Our Projects</a>
     </ul>
    </div>
   </div>
   <input type=checkbox id=sidebar-check>
   <label for=sidebar-check>
    <div id=sidebar-trigger>
     <span></span><span></span><span></span>
    </div></label><div class=sidebar><div class=header><form class=search method=GET
      action="../search/">
      <input type=text name=q>
      <input type=submit value=Search><span id=search-progress></span>
     </form>
    </div><div class=content><div class=page-toc><ul><li><p><a href="../#x-28REBLOCKS-2FDOC-2FINDEX-3A-40INDEX-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../" data-node="x-28REBLOCKS-2FDOC-2FINDEX-3A-40INDEX-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Introduction</a></p><ul><li><p><a href="../#core-features-of-reblocks" data-document="../" data-node="core-features-of-reblocks">Core Features of Reblocks</a></p></li><li><p><a href="../#removed-features" data-document="../" data-node="removed-features">Removed Features</a></p></li><li><p><a href="../#learning-reblocks" data-document="../" data-node="learning-reblocks">Learning Reblocks</a></p></li><li><p><a href="../#getting-support" data-document="../" data-node="getting-support">Getting Support</a></p></li></ul></li><li><p><a href="../installation/#x-28REBLOCKS-2FDOC-2FINSTALLATION-3A-40INSTALLATION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../installation/" data-node="x-28REBLOCKS-2FDOC-2FINSTALLATION-3A-40INSTALLATION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Installation</a></p><ul><li><p><a href="../installation/#setup-your-common-lisp-environment" data-document="../installation/" data-node="setup-your-common-lisp-environment">Setup your Common Lisp environment</a></p><ul><li><p><a href="../installation/#common-lisp-implementation" data-document="../installation/" data-node="common-lisp-implementation">Common Lisp implementation</a></p></li><li><p><a href="../installation/#development-environment-setup" data-document="../installation/" data-node="development-environment-setup">Development environment setup</a></p></li></ul></li><li><p><a href="../installation/#installation" data-document="../installation/" data-node="installation">Installation</a></p></li></ul></li><li><p><a href="../quickstart/#x-28REBLOCKS-2FDOC-2FQUICKSTART-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../quickstart/" data-node="x-28REBLOCKS-2FDOC-2FQUICKSTART-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Quickstart</a></p><ul><li><p><a href="../quickstart/#the-task-widget" data-document="../quickstart/" data-node="the-task-widget">The Task widget</a></p></li><li><p><a href="../quickstart/#the-tasks-list-widget" data-document="../quickstart/" data-node="the-tasks-list-widget">The Tasks-list widget</a></p></li><li><p><a href="../quickstart/#adding-tasks" data-document="../quickstart/" data-node="adding-tasks">Adding tasks</a></p></li><li><p><a href="../quickstart/#toggle-tasks" data-document="../quickstart/" data-node="toggle-tasks">Toggle tasks</a></p></li><li><p><a href="../quickstart/#what-is-next" data-document="../quickstart/" data-node="what-is-next">What is next?</a></p></li></ul></li><li><p><a href="../components/#x-28REBLOCKS-2FDOC-2FCOMPONENTS-3A-40COMPONENTS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../components/" data-node="x-28REBLOCKS-2FDOC-2FCOMPONENTS-3A-40COMPONENTS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Components</a></p><ul><li><p><a href="../components/#widgets" data-document="../components/" data-node="widgets">Widgets</a></p></li><li><p><a href="../components/#actions" data-document="../components/" data-node="actions">Actions</a></p></li><li><p><a href="../components/#navigations-and-dispatchers" data-document="../components/" data-node="navigations-and-dispatchers">Navigations and dispatchers</a></p></li><li><p><a href="../components/#servers" data-document="../components/" data-node="servers">Servers</a></p></li></ul></li><li><p><a href="../apps/#x-28REBLOCKS-2FDOC-2FAPP-3A-3A-40APPS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../apps/" data-node="x-28REBLOCKS-2FDOC-2FAPP-3A-3A-40APPS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Apps</a></p><ul><li><p><a href="../apps/#api" data-document="../apps/" data-node="api">API</a></p></li></ul></li><li><p><a href="../widgets/#x-28REBLOCKS-2FDOC-2FWIDGETS-3A-3A-40WIDGETS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../widgets/" data-node="x-28REBLOCKS-2FDOC-2FWIDGETS-3A-3A-40WIDGETS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Widgets</a></p><ul><li><p><a href="../widgets/#example" data-document="../widgets/" data-node="example">Example</a></p></li><li><p><a href="../widgets/#api" data-document="../widgets/" data-node="api">API</a></p></li></ul></li><li><p><a href="../rendering/#x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40RENDERING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../rendering/" data-node="x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40RENDERING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Content Rendering</a></p><ul><li><p><a href="../rendering/#x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40PAGE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../rendering/" data-node="x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40PAGE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Page Rendering</a></p></li><li><p><a href="../rendering/#x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40HTML-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../rendering/" data-node="x-28REBLOCKS-2FDOC-2FRENDERING-3A-3A-40HTML-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">HTML Rendering</a></p><ul><li><p><a href="../rendering/#api" data-document="../rendering/" data-node="api">API</a></p></li></ul></li></ul></li><li><p><a href="../actions/#x-28REBLOCKS-2FDOC-2FACTIONS-3A-3A-40ACTIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../actions/" data-node="x-28REBLOCKS-2FDOC-2FACTIONS-3A-3A-40ACTIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Actions</a></p><ul><li><p><a href="../actions/#application-actions" data-document="../actions/" data-node="application-actions">Application actions</a></p></li><li><p><a href="../actions/#session-actions" data-document="../actions/" data-node="session-actions">Session actions</a></p></li><li><p><a href="../actions/#using-at-the-frontend" data-document="../actions/" data-node="using-at-the-frontend">Using at the Frontend</a></p></li><li><p><a href="../actions/#api" data-document="../actions/" data-node="api">API</a></p></li></ul></li><li><p><a href="#x-28REBLOCKS-2FDOC-2FROUTING-3A-40ROUTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="" data-node="x-28REBLOCKS-2FDOC-2FROUTING-3A-40ROUTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Routing</a></p><ul><li><p><a href="#x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="" data-node="x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Quickstart</a></p><ul><li><p><a href="#getting-started" data-document="" data-node="getting-started">Getting started</a></p></li><li><p><a href="#extending-the-example-to-each-task-an-id" data-document="" data-node="extending-the-example-to-each-task-an-id">Extending the example: to each task an id</a></p></li><li><p><a href="#the-task-page-widget" data-document="" data-node="the-task-page-widget">The task-page widget</a></p></li><li><p><a href="#defining-routes" data-document="" data-node="defining-routes">Defining routes</a></p></li><li><p><a href="#path-and-url-parameters" data-document="" data-node="path-and-url-parameters">Path and URL parameters</a></p></li><li><p><a href="#redirections" data-document="" data-node="redirections">Redirections</a></p></li><li><p><a href="#final-steps" data-document="" data-node="final-steps">Final steps</a></p></li></ul></li><li><p><a href="#x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40LOWLEVEL-API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="" data-node="x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40LOWLEVEL-API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Lowlevel API</a></p></li></ul></li><li><p><a href="../dependencies/#x-28REBLOCKS-2FDOC-2FDEPENDENCIES-3A-3A-40DEPENDENCIES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../dependencies/" data-node="x-28REBLOCKS-2FDOC-2FDEPENDENCIES-3A-3A-40DEPENDENCIES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Dependencies</a></p><ul><li><p><a href="../dependencies/#api" data-document="../dependencies/" data-node="api">API</a></p></li></ul></li><li><p><a href="../request/#x-28REBLOCKS-2FDOC-2FREQUEST-3A-3A-40REQUEST-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../request/" data-node="x-28REBLOCKS-2FDOC-2FREQUEST-3A-3A-40REQUEST-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Request</a></p><ul><li><p><a href="../request/#api" data-document="../request/" data-node="api">API</a></p></li></ul></li><li><p><a href="../response/#x-28REBLOCKS-2FDOC-2FRESPONSE-3A-3A-40RESPONSE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../response/" data-node="x-28REBLOCKS-2FDOC-2FRESPONSE-3A-3A-40RESPONSE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Response</a></p><ul><li><p><a href="../response/#api" data-document="../response/" data-node="api">API</a></p></li></ul></li><li><p><a href="../hooks/#x-28REBLOCKS-2FDOC-2FHOOKS-3A-3A-40HOOKS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../hooks/" data-node="x-28REBLOCKS-2FDOC-2FHOOKS-3A-3A-40HOOKS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Hooks</a></p><ul><li><p><a href="../hooks/#how-to-use-these-hooks" data-document="../hooks/" data-node="how-to-use-these-hooks">How to use these hooks?</a></p></li><li><p><a href="../hooks/#defining-your-own-hooks" data-document="../hooks/" data-node="defining-your-own-hooks">Defining your own hooks</a></p></li><li><p><a href="../hooks/#hooks-api" data-document="../hooks/" data-node="hooks-api">Hooks API</a></p></li></ul></li><li><p><a href="../session/#x-28REBLOCKS-2FDOC-2FSESSION-3A-3A-40SESSION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../session/" data-node="x-28REBLOCKS-2FDOC-2FSESSION-3A-3A-40SESSION-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Using the Session</a></p><ul><li><p><a href="../session/#session-initialization" data-document="../session/" data-node="session-initialization">Session initialization</a></p></li><li><p><a href="../session/#storing-data" data-document="../session/" data-node="storing-data">Storing data</a></p></li><li><p><a href="../session/#api" data-document="../session/" data-node="api">API</a></p></li></ul></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FINDEX-3A-3A-40REMOVED-FEATURES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FINDEX-3A-3A-40REMOVED-FEATURES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Removed Features</a></p><ul><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FVIEWS-3A-3A-40VIEWS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FVIEWS-3A-3A-40VIEWS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Views</a></p></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FTEMPLATES-3A-3A-40TEMPLATES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FTEMPLATES-3A-3A-40TEMPLATES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Templates</a></p><ul><li><p><a href="../removed-features/#template-function" data-document="../removed-features/" data-node="template-function">Template function</a></p></li><li><p><a href="../removed-features/#template-definition" data-document="../removed-features/" data-node="template-definition">Template definition</a></p></li></ul></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FFORMS-3A-3A-40FORMS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FFORMS-3A-3A-40FORMS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Forms</a></p><ul><li><p><a href="../removed-features/#introduction" data-document="../removed-features/" data-node="introduction">Introduction</a></p></li><li><p><a href="../removed-features/#simple-example" data-document="../removed-features/" data-node="simple-example">Simple example</a></p></li><li><p><a href="../removed-features/#quickforms" data-document="../removed-features/" data-node="quickforms">Quickforms</a></p></li></ul></li><li><p><a href="../removed-features/#x-28REBLOCKS-2FDOC-2FCONTINUATIONS-3A-3A-40CONTINUATIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../removed-features/" data-node="x-28REBLOCKS-2FDOC-2FCONTINUATIONS-3A-3A-40CONTINUATIONS-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Continuations-based tools</a></p></li></ul></li><li><p><a href="../api/#x-28REBLOCKS-2FDOC-2FAPI-3A-40API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../api/" data-node="x-28REBLOCKS-2FDOC-2FAPI-3A-40API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Unsorted API</a></p><ul><li><p><a href="../api/#variables" data-document="../api/" data-node="variables">Variables</a></p></li></ul></li><li><p><a href="../contribute/#x-28REBLOCKS-2FDOC-2FCONTRIBUTE-3A-3A-40CONTRIBUTE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../contribute/" data-node="x-28REBLOCKS-2FDOC-2FCONTRIBUTE-3A-3A-40CONTRIBUTE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Contributing to Reblocks</a></p></li><li><p><a href="../changelog/#x-28REBLOCKS-2FDOC-2FCHANGELOG-3A-40CHANGELOG-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../changelog/" data-node="x-28REBLOCKS-2FDOC-2FCHANGELOG-3A-40CHANGELOG-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">ChangeLog</a></p></li></ul>
     </div>
    </div><div class=footer>
     <a href=https://40ants.com/doc>[generated by 40ANTS-DOC]</a>
    </div>
   </div><div class=content role=main><h1>Routing<a class=header-link
     href=#x-28REBLOCKS-2FDOC-2FROUTING-3A-40ROUTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29
     title="Permalink to this headline"
     id=x-28REBLOCKS-2FDOC-2FROUTING-3A-40ROUTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29>
      ¶</a></h1><h2>Quickstart<a class=header-link
     href=#x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29
     title="Permalink to this headline"
     id=x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40QUICKSTART-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29>
      ¶</a></h2><p>In the quickstart tutorial, we saw how to create and render widgets,
and how to react to user events. We also learned that by default the
app name defined its base url, and how to change it.</p><p>Here, we will extend the example and make each task accessible under
<code>/tasks/&lt;task id&gt;</code>.</p><p>Before we start, here's the summary on how to handle routing in
Reblocks:</p><ul><li><p>use <code>REBLOCKS-NAVIGATION-WIDGET:DEFROUTES</code>.</p></li><li><p><code>DEFROUTES</code> associates <code>URL</code>s (as strings) to a widget:</p></li></ul><pre><code class="">(defroutes tasks-routes
  (&quot;/tasks/\d+&quot; (make-task-page))
  (&quot;/tasks/&quot; (make-task-list)))</code></pre><ul><li><p><a href="https://40ants.com/reblocks/session/#x-28REBLOCKS-2FSESSION-3AINIT-20GENERIC-FUNCTION-29" data-document="https://40ants.com/reblocks/session/" data-node="x-28REBLOCKS-2FSESSION-3AINIT-20GENERIC-FUNCTION-29"><code>reblocks/session:init</code></a> must return an instance of the route
  widget, using the <code>MAKE-TASKS-ROUTES</code> constructor created by <code>DEFROUTES</code> macro.</p></li></ul><p>Let's start. Note that you can see the full code
<a href="https://github.com/40ants/reblocks/blob/reblocks/docs/source/routing.lisp">on Github</a>.</p><h3 id="getting-started">Getting started</h3><blockquote><p><b>Warning!</b></p><p>As for this version of Reblocks,
<code>REBLOCKS-NAVIGATION-WIDGET</code> system is not in Quicklisp
yet. To install it you need to clone the repository
somewhere where <code>ASDF</code> will find it, for example, to the
<code>~/common-lisp/</code> or <code>~/quicklisp/local-projects/</code>
directories.</p></blockquote><p>You can also install the <a href="https://ultralisp.org/">Ultralisp</a> Quicklisp distribution where all Reblocks-related libraries are present and up to date.</p><p>Load and import the routing library:</p><pre><code class="">TODO&gt; (ql:quickload '(:reblocks-navigation-widget))</code></pre><p>The package definition becomes::</p><pre><code class="">TODO&gt; (defpackage todo
        (:use #:cl
              #:reblocks-ui/form
              #:reblocks/html)
        (:import-from #:reblocks/widget
                      #:render
                      #:update
                      #:defwidget)
        (:import-from #:reblocks/actions
                      #:make-js-action)
        (:import-from #:reblocks/app
                      #:defapp)
        (:import-from #:reblocks-navigation-widget
                      #:defroutes))</code></pre><h3 id="extending-the-example-to-each-task-an-id">Extending the example: to each task an id</h3><p>We want each task to have an id, so we add a slot to the <code>task</code> widget:</p><pre><code class="">TODO&gt; (defwidget task ()
        ((title
          :initarg :title
          :initform nil
          :accessor title)
         (done
          :initarg :done
          :initform nil
          :accessor done)
         (id
          :initarg :id
          :initform nil
          :accessor id
          :type integer)))</code></pre><p>We also need a simple in-memory &quot;database&quot;. We'll use a hash-table to
save the tasks. It associates an id to the task:</p><pre><code class="">TODO&gt; (defparameter *store* (make-hash-table) &quot;Dummy store for tasks: id -&gt; task.&quot;)</code></pre><p>Our task constructor will give them an incremental id:</p><pre><code class="">TODO&gt; (defparameter *counter* 0 &quot;Simple counter for the hash table store.&quot;)
TODO&gt; (defun make-task (title &amp;key done)
        &quot;Create a task and store it by its id.&quot;
        (let* ((id (incf *counter*))
               (task (make-instance 'task :title title :done done :id id)))
          (setf (gethash id *store*) task)
          task))</code></pre><p>So we create a utility function to find a task by its id. All this
could just be an interface to a database.</p><pre><code class="">TODO&gt; (defun get-task (id)
        (gethash id *store*))</code></pre><p>When we render the tasks list, we add an href on the task, so we can go to <code>/tasks/&lt;id&gt;</code>:</p><pre><code class="">TODO&gt; (defmethod render ((task task))
        (with-html
          (:p (:input :type &quot;checkbox&quot;
                      :checked (done task)
                      :onclick (make-js-action
                                (lambda (&amp;key &amp;allow-other-keys)
                                  (toggle task))))
              (:span (if (done task)
                         (with-html
                           (:s (title task)))
                         (:a :href (format nil &quot;/tasks/~a&quot; (id task)) ;; &lt;-- only addition.
                             (title task)))))))</code></pre><h3 id="the-task-page-widget">The task-page widget</h3><p>In Reblocks, an <code>HTML</code> block that we want to display, and possibly update
independently, is a widget. Here, we want to show a task's details on
their own page, it is then a widget.</p><pre><code class="">TODO&gt; (defwidget task-page ()
        ((task
          :initarg :task
          :initform nil
          :accessor task)))

TODO&gt; (defmethod render ((task-page task-page))
        (let ((task (task task-page)))
          (with-html
            (:div &quot;Task &quot; (id task))
            (:h1 (title task))
            (:div (if (done task) &quot;Done!&quot; &quot;To Do.&quot;))
            (:div &quot;Lorem ipsum…&quot;))))</code></pre><h3 id="defining-routes">Defining routes</h3><p>At this point we can think of our routes like this:</p><pre><code class="">(defroutes tasks-routes
  (&quot;/tasks/\d+&quot; &lt;create the task-page widget&gt;)
  (&quot;/tasks/&quot; (make-task-list)))</code></pre><p>The regexp <code>\d+</code> will capture any <code>URL</code> that is formed of digits and
contains at least one.</p><p>As we see, the <code>TASK-PAGE</code> constructor will need to get the id
matched by the route.</p><h3 id="path-and-url-parameters">Path and URL parameters</h3><p>To get the current path, use <code>(reblocks/request:get-path)</code>. Then,
you can find the matching parameters with <a href="https://edicl.github.io/cl-ppcre/">CL-PPCRE</a>.</p><p>Our <code>TASK-PAGE</code> constructor becomes:</p><pre><code class="">TODO&gt; (defun make-task-page ()
        (let* ((path (reblocks/request:get-path))
               (id (first (ppcre:all-matches-as-strings &quot;\d+&quot; path)))
               (task (get-task (parse-integer id))))
          (if task
              (make-instance 'task-page :task task)
              (not-found))))
TODO&gt; (defun not-found ()
        &quot;Show a 404 not found page.&quot;
        (with-html
          (:div &quot;Task not found.&quot;)))</code></pre><p>And our router is simply:</p><pre><code class="">TODO&gt; (defroutes tasks-routes
        (&quot;/tasks/\d+&quot; (make-task-page))
        (&quot;/tasks/&quot; (make-task-list &quot;Make my first Reblocks app&quot;
                                   &quot;Deploy it somewhere&quot;
                                   &quot;Have a profit&quot;)))</code></pre><p>The <code>DEFROUTES</code> macro creates a new class and its constructor, named
<code>MAKE-&lt;CLASS-NAME&gt;</code>.</p><blockquote><p><b>Note</b></p><p>It is important to use the constructor instead of <code>MAKE-INSTANCE</code>, as it defines properties on the fly.</p></blockquote><h3 id="redirections">Redirections</h3><p>To perform redirections, use <code>(reblocks/response:redirect &quot;/url&quot;)</code>:</p><pre><code class="">TODO&gt; (defroutes tasks-routes
        (&quot;/tasks/\d+&quot; (make-task-page))
        (&quot;/tasks/list/?&quot; (reblocks/response:redirect &quot;/tasks/&quot;))  ;; &lt;-- redirection
        (&quot;/tasks/&quot; (make-task-list &quot;Make my first Reblocks app&quot;
                                   &quot;Deploy it somewhere&quot;
                                   &quot;Have a profit&quot;)))</code></pre><p>Here the trailing <code>/?</code> allows to catch <code>/tasks/list</code> and <code>/tasks/list/</code>.</p><p>And indeed, contrary to what we stated in the introduction,
<a href="https://40ants.com/reblocks/api/#x-28REBLOCKS-2FRESPONSE-3AREDIRECT-20FUNCTION-29" data-document="https://40ants.com/reblocks/api/" data-node="x-28REBLOCKS-2FRESPONSE-3AREDIRECT-20FUNCTION-29"><code>reblocks/response:redirect</code></a> does not return a widget but signals a specital condition.</p><h3 id="final-steps">Final steps</h3><p>Make our router the main widget for this session:</p><pre><code class="">TODO&gt; (defmethod reblocks/session:init ((app tasks))
        (declare (ignorable app))
        (make-tasks-routes))</code></pre><p>Reset the session:</p><pre><code class="">TODO&gt; (defun reset ()
        (setf *counter* 0)
        (reblocks/debug:reset-latest-session))
TODO&gt; (reset)</code></pre><p>And access the app at <a href="http://localhost:40000/tasks/">http://localhost:40000/tasks/</a>.</p><h2>Lowlevel API<a class=header-link
     href=#x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40LOWLEVEL-API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29
     title="Permalink to this headline"
     id=x-28REBLOCKS-2FDOC-2FROUTING-3A-3A-40LOWLEVEL-API-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29>
      ¶</a></h2><ul>
     <li><a href=#x-28REBLOCKS-2FROUTES-3AROUTE-20CLASS-29></a><span
      class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/routes.lisp#L13>
         [class]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FROUTES-3AROUTE-20CLASS-29
         id=x-28REBLOCKS-2FROUTES-3AROUTE-20CLASS-29>reblocks/routes:route</a>
        </div></span><span class=locative-args></span><p>Inherit from this class to add a custom routes.</p> </span>
    </ul><ul>
     <li><a
      href=#x-28REBLOCKS-2FROUTES-3ADEFROUTE-20-2840ANTS-DOC-2FLOCATIVES-3AMACRO-29-29></a>
      <span class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/routes.lisp#L88>
         [macro]</a>
        <div class=reference-object
             style="display: inline-block">
         <a
         href=#x-28REBLOCKS-2FROUTES-3ADEFROUTE-20-2840ANTS-DOC-2FLOCATIVES-3AMACRO-29-29
         id=x-28REBLOCKS-2FROUTES-3ADEFROUTE-20-2840ANTS-DOC-2FLOCATIVES-3AMACRO-29-29>
          reblocks/routes:defroute</a>
        </div></span><span class=locative-args>(APP ROUTE &amp;KEY (CONTENT-TYPE 
        &quot;application/json&quot;)) &amp;BODY BODY</span><p>Defines a handler for a given route. By default route should return
a serialized <code>JSON</code>:</p><pre><code class="lisp">(defroute (app /api/data)
    &quot;{&quot;my-data&quot;: [1, 2, 3]}&quot;)</code></pre><p>but you can redefine the content type:</p><pre><code class="lisp">(defroute (app /api/data :content-type &quot;application/xml&quot;)
    &quot;&lt;my-data&gt;&lt;item&gt;1&lt;/item&gt;&lt;item&gt;2&lt;/item&gt;&lt;/my-data&gt;&quot;)</code></pre> </span>
    </ul><ul>
     <li><a href=#x-28REBLOCKS-2FROUTES-3AGET-ROUTE-20FUNCTION-29></a><span
      class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/routes.lisp#L33>
         [function]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FROUTES-3AGET-ROUTE-20FUNCTION-29
         id=x-28REBLOCKS-2FROUTES-3AGET-ROUTE-20FUNCTION-29>reblocks/routes:get-route</a>
        </div></span><span class=locative-args>path</span><p>Returns a route, matched on given path.
If none matched, then returns nil.</p><p>Path should be a string.</p><p>This function could be useful for customizing widget rendering
depending on the <code>URL</code> in the browser.</p> </span>
    </ul><ul>
     <li><a href=#x-28REBLOCKS-2FROUTES-3ASERVE-20GENERIC-FUNCTION-29></a><span
      class=reference-bullet><span class=reference><a class=locative-type
        href=https://github.com/40ants/reblocks/blob/06abcca61eb7e546a78b062fa53538da6f5b42c2/src/routes.lisp#L60>
         [generic-function]</a>
        <div class=reference-object
             style="display: inline-block">
         <a href=#x-28REBLOCKS-2FROUTES-3ASERVE-20GENERIC-FUNCTION-29
         id=x-28REBLOCKS-2FROUTES-3ASERVE-20GENERIC-FUNCTION-29>reblocks/routes:serve</a>
        </div></span><span class=locative-args>route env</span><p>Methods should return a list like that:</p><pre><code class="lisp">(list 200                                ;; status-code
      (list :content-type content-type)  ;; headers
      content)                           ;; content</code></pre> </span>
    </ul>
   </div><div class=footer>
    <hr class=separator>
    <p class=fineprint>Created with passion by <em>40Ants</em><a class=lisp-logo
     href="http://lisp-lang.org/">
      <img
           src=https://40ants.com/img/made-with-lisp.svg></a>
   </div>
  </div>
 </body>
</html>